<!DOCTYPE html>
<html>
<head>
    <title>Python Docker Analytics Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        
        .container { 
            max-width: 1400px; margin: 0 auto; 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: 1fr 1fr; 
            gap: 30px; 
            height: calc(100vh - 40px);
        }
        
        .stats-panel { grid-column: 1; grid-row: 1; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .visitors-panel { grid-column: 1; grid-row: 2; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .tutorial-panel { grid-column: 2; grid-row: 1; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow-y: auto; }
        .image-panel { grid-column: 2; grid-row: 2; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; }
        
        .counter { font-size: 4.5em; font-weight: bold; color: #007bff; margin: 20px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .metric { background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); padding: 15px; border-radius: 15px; margin: 15px 0; color: white; font-size: 1.1em; }
        .metric strong { display: block; font-size: 1.8em; }
        .button-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        button { border: none; padding: 12px 24px; font-size: 1em; border-radius: 25px; color: white; cursor: pointer; transition: all 0.2s; font-weight: 500; }
        button:hover { transform: scale(1.05); }
        .track-btn { background: linear-gradient(45deg, #10b981, #059669); }
        .clear-visits-btn { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .clear-users-btn { background: linear-gradient(45deg, #f59e0b, #d97706); }
        
        .table-container { height: 60%; overflow-y: auto; border: 2px solid #e0e6ed; border-radius: 10px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #4facfe; color: white; position: sticky; top: 0; z-index: 10; }
        tr:hover { background: #f8f9ff; }
        .status { padding: 5px 10px; border-radius: 20px; font-size: 0.8em; background: #4ade80; color: white; }
        
        h1 { color: #333; margin-bottom: 20px; text-align: center; font-size: 1.8em; }
        h2 { color: #555; margin-bottom: 20px; font-size: 1.4em; }
        
        /* COLLAPSIBLE STEPS */
        .collapsible { background: #f8f9ff; border-radius: 10px; margin: 10px 0; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .step-header { 
            padding: 20px; cursor: pointer; background: linear-gradient(135deg, #4facfe, #3b82f6); 
            color: white; font-weight: bold; display: flex; align-items: center; 
            transition: all 0.3s; user-select: none;
        }
        .step-header:hover { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .step-number { background: white; color: #4facfe; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }
        .step-content { max-height: 0; overflow: hidden; background: white; transition: max-height 0.3s ease-out; }
        .step-content.active { max-height: 500px; padding: 20px; }
        .code { background: #f1f3f4; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.9em; margin: 10px 0; white-space: pre-wrap; border-left: 4px solid #4facfe; }
        
        .architecture-img { width: 100%; max-height: 350px; object-fit: contain; border-radius: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .youtube-link { display: inline-block; background: #ff0000; color: white; padding: 12px 24px; text-decoration: none; border-radius: 25px; margin: 15px 0; font-weight: bold; }
        .youtube-link:hover { background: #cc0000; }
        
        @media (max-width: 768px) { 
            .container { grid-template-columns: 1fr; grid-template-rows: auto auto auto auto; height: auto; gap: 20px; }
            .stats-panel, .visitors-panel, .tutorial-panel, .image-panel { grid-column: 1; }
            .stats-panel { grid-row: 1; }
            .visitors-panel { grid-row: 2; }
            .tutorial-panel { grid-row: 3; }
            .image-panel { grid-row: 4; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LEFT TOP: Live Analytics -->
        <div class="stats-panel">
            <h1>üöÄ Live Analytics</h1>
            <div class="counter" id="visits">0</div>
            <div class="metric">
                <strong id="users">0</strong>Unique Visitors
            </div>
            <div class="metric">
                <strong id="peak">0</strong>Peak Visits
            </div>
            <p id="message" style="font-size: 1.2em; margin: 20px 0; color: #666;">Redis Message: Loading...</p>
            <div class="button-group">
                <button class="track-btn" onclick="trackMe()">üéØ Track Visit</button>
                <button class="clear-visits-btn" onclick="clearVisits()">üóëÔ∏è Clear Counts</button>
                <button class="clear-users-btn" onclick="clearVisitors()">üë• Clear Visitors</button>
            </div>
        </div>
        
        <!-- LEFT BOTTOM: Visitors Table -->
        <div class="visitors-panel">
            <h2>üë• Recent Visitors</h2>
            <div class="table-container" id="visitorsTable">
                <table>
                    <thead><tr><th>#</th><th>IP Address</th><th>Status</th><th>Time</th></tr></thead>
                    <tbody id="visitorsBody">
                        <tr><td colspan="4" style="text-align:center;padding:40px;color:#999;">Loading visitors...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- RIGHT TOP: Collapsible Tutorial -->
        <div class="tutorial-panel">
            <h2>üìö Docker Compose Tutorial</h2>
            <a href="https://www.youtube.com/watch?v=23ij4bub_Hw" target="_blank" class="youtube-link">üé• Watch Video (18min)</a>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">1</span>Prerequisites & Setup
                </div>
                <div class="step-content">
                    <strong>Install Docker Desktop</strong><br>
                    <div class="code">Download from docker.com ‚Üí Install ‚Üí Start Docker Desktop</div>
                    Provides Docker CLI + Docker Compose automatically
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">2</span>Create Project Folder
                </div>
                <div class="step-content">
                    <strong>Make single folder for everything</strong><br>
                    <div class="code">mkdir docker-compose-demo
cd docker-compose-demo</div>
                    Open in VS Code: <code>code .</code>
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">3</span>app.py (Flask + Redis)
                </div>
                <div class="step-content">
                    <strong>Create basic Flask app with Redis counter</strong><br>
                    <div class="code">from flask import Flask, render_template, request
import redis
app = Flask(__name__)
r = redis.Redis(host='redis', port=6379)
@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        r.incr('clicks')
    clicks = r.get('clicks').decode('utf-8') or '0'
    return render_template('index.html', clicks=clicks)
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)</div>
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">4</span>Simple index.html
                </div>
                <div class="step-content">
                    <strong>Basic HTML with color changer</strong><br>
                    <div class="code"><!DOCTYPE html>
<html><head><title>Docker Compose</title></head>
<body style="transition: background 0.5s;">
<h1>This is Docker Compose App</h1>
<form method="POST"><button>Change Color</button></form>
<p>Clicks: {{ clicks }}</p>
</body></html></div>
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">5</span>requirements.txt + Dockerfile
                </div>
                <div class="step-content">
                    <strong>Python dependencies + container build</strong><br>
                    <div class="code">requirements.txt:
Flask
redis

Dockerfile:
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 5000
CMD ["python", "app.py"]</div>
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">6</span>docker-compose.yml
                </div>
                <div class="step-content">
                    <strong>Multi-container definition</strong><br>
                    <div class="code">version: '3'
services:
  app:
    build: .
    ports:
      - "5000:5000"
    depends_on:
      - redis
  redis:
    image: redis:alpine</div>
                    Flask connects to Redis via service name "redis"
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">7</span>Deploy Commands
                </div>
                <div class="step-content">
                    <strong>Exact video commands</strong><br>
                    <div class="code">docker compose down     # Cleanup
docker compose build    # Build images  
docker compose up       # Run (foreground)
# OR: docker compose up -d  (background)</div>
                    Visit: http://localhost:5000
                </div>
            </div>
            
            <div class="collapsible">
                <div class="step-header" onclick="toggleStep(this)">
                    <span class="step-number">‚úÖ</span>Expected Result
                </div>
                <div class="step-content">
                    <strong>Success Indicators</strong><br>
                    ‚úÖ 2 containers in Docker Desktop<br>
                    ‚úÖ http://localhost:5000 loads<br>
                    ‚úÖ Click button ‚Üí color changes + count ‚Üë<br>
                    ‚úÖ Flask ‚Üî Redis communication works
                </div>
            </div>
        </div>
        
        <!-- RIGHT BOTTOM: Architecture -->
        <div class="image-panel">
            <h2>üèóÔ∏è Architecture Diagram</h2>
            <img src="/static/Project-2_Architecture_Diagram.png" alt="Docker Compose Architecture" class="architecture-img">
            <p style="margin-top: 15px; color: #666;">Flask App ‚Üî Redis | Multi-Container Demo</p>
        </div>
    </div>

    <script>
        const tableBody = document.getElementById('visitorsBody');
        
        function updateStats() {
            fetch('/api/stats').then(r=>r.json()).then(d=>{
                document.getElementById('visits').textContent = d.visits.toLocaleString();
                document.getElementById('users').textContent = d.users.toLocaleString();
                document.getElementById('message').textContent = `Redis: ${d.message}`;
            });
        }
        
        function updateLeaderboard() {
            fetch('/api/leaderboard').then(r=>r.json()).then(d=>{
                document.getElementById('peak').textContent = d.peak.toLocaleString();
                tableBody.innerHTML = '';
                (d.recent.slice(0,15) || []).forEach((ip, index) => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `<td>${index + 1}</td><td>${ip || 'N/A'}</td><td><span class="status">Live</span></td><td>${new Date().toLocaleTimeString()}</td>`;
                });
            });
        }
        
        function trackMe() { fetch(`/api/users/${Math.random().toString(36).substr(2,9)}`); updateStats(); updateLeaderboard(); }
        function clearVisits() { fetch('/api/clear/visits').then(() => { updateStats(); updateLeaderboard(); }); }
        function clearVisitors() { fetch('/api/clear/visitors').then(() => { updateStats(); updateLeaderboard(); }); }
        
        // Collapsible toggle
        function toggleStep(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }
        
        updateStats(); updateLeaderboard(); 
        setInterval(() => { updateStats(); updateLeaderboard(); }, 2000);
    </script>
</body>
</html>
