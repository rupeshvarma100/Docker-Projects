<!DOCTYPE html>
<html>
<head>
    <title>Python Docker Analytics Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: 1fr 1fr; 
            gap: 30px; 
            height: calc(100vh - 40px);
        }
        
        /* LEFT COLUMN */
        .stats-panel { grid-column: 1; grid-row: 1; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .visitors-panel { grid-column: 1; grid-row: 2; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        
        /* RIGHT COLUMN */
        .tutorial-panel { grid-column: 2; grid-row: 1; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow-y: auto; max-height: 100%; }
        .image-panel { grid-column: 2; grid-row: 2; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; }
        
        .counter { font-size: 4.5em; font-weight: bold; color: #007bff; margin: 20px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .metric { background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); padding: 15px; border-radius: 15px; margin: 15px 0; color: white; font-size: 1.1em; }
        .metric strong { display: block; font-size: 1.8em; }
        
        .button-group { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        button { border: none; padding: 12px 24px; font-size: 1em; border-radius: 25px; color: white; cursor: pointer; transition: all 0.2s; font-weight: 500; }
        button:hover { transform: scale(1.05); }
        .track-btn { background: linear-gradient(45deg, #10b981, #059669); }
        .clear-visits-btn { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .clear-users-btn { background: linear-gradient(45deg, #f59e0b, #d97706); }
        
        .table-container { height: 60%; overflow-y: auto; border: 2px solid #e0e6ed; border-radius: 10px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #4facfe; color: white; position: sticky; top: 0; z-index: 10; }
        tr:hover { background: #f8f9ff; }
        .status { padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
        .live { background: #4ade80; color: white; }
        
        h1 { color: #333; margin-bottom: 20px; text-align: center; font-size: 1.8em; }
        h2 { color: #555; margin-bottom: 20px; font-size: 1.4em; }
        .tutorial-steps { background: #f8f9ff; border-radius: 10px; padding: 20px; margin-top: 20px; max-height: 85%; overflow-y: auto; }
        .step { margin: 15px 0; padding: 18px; background: white; border-left: 5px solid #4facfe; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .step-number { background: #4facfe; color: white; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; font-size: 1em; float: left; margin-top: 2px; }
        .step-content { display: block; margin-left: 44px; }
        .code { background: #f1f3f4; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.85em; margin: 8px 0; white-space: pre-wrap; }
        .highlight { border-left-color: #10b981 !important; box-shadow: 0 4px 12px rgba(16,185,129,0.3); }
        .architecture-img { width: 100%; max-height: 350px; object-fit: contain; border-radius: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .youtube-link { display: inline-block; background: #ff0000; color: white; padding: 12px 24px; text-decoration: none; border-radius: 25px; margin: 15px 0; font-weight: bold; }
        .youtube-link:hover { background: #cc0000; }
        
        @media (max-width: 768px) { 
            .container { grid-template-columns: 1fr; grid-template-rows: auto auto auto auto; height: auto; gap: 20px; }
            .stats-panel { grid-row: 1; grid-column: 1; }
            .visitors-panel { grid-row: 2; grid-column: 1; }
            .tutorial-panel { grid-row: 3; grid-column: 1; }
            .image-panel { grid-row: 4; grid-column: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LEFT TOP: Live Analytics + Buttons -->
        <div class="stats-panel">
            <h1>üöÄ Live Analytics</h1>
            <div class="counter" id="visits">0</div>
            <div class="metric">
                <strong id="users">0</strong>Unique Visitors
            </div>
            <div class="metric">
                <strong id="peak">0</strong>Peak Visits
            </div>
            <p id="message" style="font-size: 1.2em; margin: 20px 0; color: #666;">Redis Message: Loading...</p>
            <div class="button-group">
                <button class="track-btn" onclick="trackMe()">üéØ Track My Visit</button>
                <button class="clear-visits-btn" onclick="clearVisits()">üóëÔ∏è Clear Counts</button>
                <button class="clear-users-btn" onclick="clearVisitors()">üë• Clear Visitors</button>
            </div>
        </div>
        
        <!-- LEFT BOTTOM: Recent Visitors -->
        <div class="visitors-panel">
            <h2>üë• Recent Visitors</h2>
            <div class="table-container" id="visitorsTable">
                <table>
                    <thead><tr><th>#</th><th>IP Address</th><th>Status</th><th>Time</th></tr></thead>
                    <tbody id="visitorsBody">
                        <tr><td colspan="4" style="text-align:center;padding:40px;color:#999;">Loading visitors...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- RIGHT TOP: Docker Compose Tutorial -->
        <div class="tutorial-panel">
            <h2>üìö Docker Compose Tutorial (Project-2)</h2>
            <a href="https://www.youtube.com/watch?v=23ij4bub_Hw" target="_blank" class="youtube-link">üé• Watch Original Tutorial</a>
            <div class="tutorial-steps">
                <h3>üöÄ Complete Setup Guide</h3>
                <div class="step">
                    <span class="step-number">1</span>
                    <div class="step-content">
                        <strong>Create Project</strong><br>
                        <div class="code">mkdir Project-2 && cd Project-2</div>
                        Single directory for ALL files
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <div class="step-content">
                        <strong>requirements.txt</strong><br>
                        <div class="code">Flask==3.0.3
redis==5.1.0
gunicorn==22.0.0</div>
                        Python web framework + Redis + production server
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <div class="step-content">
                        <strong>Dockerfile</strong><br>
                        <div class="code">FROM python:3.11-slim
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["gunicorn", "app:app"]</div>
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">4</span>
                    <div class="step-content">
                        <strong>docker-compose.yml</strong><br>
                        <div class="code">services:
  app:
    build: .
    ports:
      - "8000:5000"
  redis:
    image: redis:alpine</div>
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">5</span>
                    <div class="step-content">
                        <strong>Deploy</strong><br>
                        <div class="code">docker compose down -v
docker compose up --build -d</div>
                        Visit: http://localhost:8000
                    </div>
                </div>
                <div class="step highlight">
                    <span class="step-number">üéØ</span>
                    <div class="step-content">
                        <strong>Production Ready</strong><br>
                        ‚úÖ Multi-container Flask+Redis<br>
                        ‚úÖ Real-time analytics dashboard<br>
                        ‚úÖ Persistent Redis data<br>
                        ‚úÖ AKS/Kubernetes migration ready
                    </div>
                </div>
            </div>
        </div>
        
        <!-- RIGHT BOTTOM: Architecture Image -->
        <div class="image-panel">
            <h2>üèóÔ∏è Architecture Diagram</h2>
            <img src="/static/Project-2_Architecture_Diagram.png" alt="Docker Compose Architecture" class="architecture-img">
            <p style="margin-top: 15px; color: #666; font-size: 0.9em;">Flask App ‚Üî Redis Multi-Container Setup</p>
        </div>
    </div>

    <script>
        const tableBody = document.getElementById('visitorsBody');
        
        function updateStats() {
            fetch('/api/stats').then(r=>r.json()).then(d=>{
                document.getElementById('visits').textContent = d.visits.toLocaleString();
                document.getElementById('users').textContent = d.users.toLocaleString();
                document.getElementById('message').textContent = `Redis: ${d.message}`;
            });
        }
        
        function updateLeaderboard() {
            fetch('/api/leaderboard').then(r=>r.json()).then(d=>{
                document.getElementById('peak').textContent = d.peak.toLocaleString();
                tableBody.innerHTML = '';
                (d.recent.slice(0,15) || []).forEach((ip, index) => {
                    const row = tableBody.insertRow();
                    row.innerHTML = `<td>${index + 1}</td><td>${ip || 'N/A'}</td><td><span class="status live">Live</span></td><td>${new Date().toLocaleTimeString()}</td>`;
                });
            });
        }
        
        function trackMe() {
            fetch(`/api/users/${Math.random().toString(36).substr(2,9)}`);
            updateStats(); updateLeaderboard();
        }
        
        function clearVisits() {
            fetch('/api/clear/visits').then(() => {
                updateStats(); updateLeaderboard();
            });
        }
        
        function clearVisitors() {
            fetch('/api/clear/visitors').then(() => {
                updateStats(); updateLeaderboard();
            });
        }
        
        // Initial load + auto-refresh
        updateStats(); updateLeaderboard(); 
        setInterval(() => { updateStats(); updateLeaderboard(); }, 2000);
    </script>
</body>
</html>
